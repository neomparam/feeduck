<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <link rel="stylesheet" type="text/css" href="bootstrap-3.0.1-dist/dist/css/bootstrap.min.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="non-responsive.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="assets/feeduck-host.css" media="screen" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Feeduck</title>
    <script type="text/javascript">
        function createForm() 
        {
          if ( document.getElementById("title").value == "" ) {
            $("#title").parents().addClass("has-error");
            return false;
          }

          $("#title").parents().removeClass("has-error");

          $("#response").hide();
          $("#form_create input[type=text]").blur();
          $("#form_create input[type=text]").prop("disabled", true);
          $("#form_create button[type=submit]").prop("disabled", true);

          var url = "https://script.google.com/macros/s/AKfycbzcw8Gr8Z5lLA1b9CZtYm-1__Ymr8AHxygGtlyZL2NR3nhtO5Q/exec";
          var script = document.createElement("script");
          script.setAttribute('type', 'text/javascript');
          script.setAttribute('src', url + "?a=create&c=onJsonpResponse&title=" + document.getElementById("title").value);
          
          document.getElementsByTagName('head')[0].appendChild(script);

          // gs.create($("#title").val(), onJsonpResponse);

          progress.val(0);
          progress.show();
          progress.start(10);

          // startWatch();

          return false;
        }
        
        function onJsonpResponse(form_id, entry_id)
        {
          $("#progress_create").hide();
          $("#response").show();
          $("#form_create input[type=text]").prop("disabled", false);
          $("#form_create button[type=submit]").prop("disabled", false);


          var code = $("#code");
          code.text('' +
            '<script src="http://code.jquery.com/jquery-1.10.2.min.js"></scr' + 'ipt>\n' +
            '<script type="text/javascript" src="http://neomparam.github.io/feeduck/feeduck.jquery.js"></scr' + 'ipt>\n' + 
            '<link rel="stylesheet" href="http://neomparam.github.io/feeduck/feeduck.css" type="text/css" />\n' + 
            '<script>\n' + 
            '\tFeeduck.init({\n' +
            '\t\tform_id: "'+form_id+'",\n' +
            '\t\tentry_id: "'+entry_id+'",\n' +
            '\t\tplaceholder: "의견을 남겨주세요.",\n' +
            '\t\tthanks_message: "<p>소중한 의견 감사합니다.</p>",\n' +
            '\t\tsend_callback: function(text) {\n' +
            '\t\t},\n' +
            '\t});\n' +
            '</scr' + 'ipt>'
          );

          // prop = {
          //   version: '0.1',
          //   file_id: form_id,
          //   data: {
          //     entry_id: entry_id
          //   }
          // };
          // insertProperty(form_id, 'feeduck', JSON.stringify(prop), 'PUBLIC');
          // loadFiles();
        }

      function checkAuth()
      {
        gs.checkAuth(
          function () {
            showPage("page_main");
          },
          function () {
            showPage("page_login");
            $("#btnLogin").click(function(e) {
              document.location.href = config.url + '?r=' + document.location.href;
              e.preventDefault();
              return false;
            });
          }
        );
      }

      // main
      $(function() {
        checkAuth();
        progress = new Progress(document.getElementById("progress_create"));
      })
    </script>
    <!--script type="text/javascript" src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script-->
  </head>
  <body>
    <div class="container">
      <header>
        <div class="page-header">
          <h1>Feeduck <small>간편하게 피드백을 받으세요!</small></h1>
        </div>
        <div class="hidden">
          <button id="test" class="btn btn-danger" onclick="test();">TEST</button>
        </div>
      </header>
      <div id="content">
        <div>
          <p>
              사용자 건의사항을 바로 받아볼 수 있습니다. <br>
              따로 저장소를 구성할 필요 없이, 구글 스프레드시트에 바로 저장하세요.
          </p>
        </div>
        <div id="page_login" class="page">
          <p>
              구글 스프레드시트를 생성하기 위해 로그인이 필요합니다.
          </p>
          <button type="button" id="btnLogin" class="btn btn-primary btn-lg">Login with Google.</button>
        </div>
        <div id="page_main" class="page">
          <div class="jumbotron">
            <form class="" role="form" id="form_create" name="" action="#" onsubmit="return createForm();">
              <div class="form-group">
                <label for="title">Form Title</label>
                <input type="text" class="form-control input-lg" name="title" id="title" placeholder="제목을 입력하세요."/>
              </div>
              <button type="submit" class="btn btn-primary input-lg" style="width:120px;font-size:18px;">Create</button>
              <div id="progress_create" class="progress progress-striped active" style="margin-top:20px;display:none;">
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%"></div>
              </div>
            </form>
            <div id="response" style="display:none;margin-top:20px;">
              <label>Form이 생성되었습니다. 아래의 코드를 붙여넣기 하세요.</label>
              <textarea id="code" class="form-control" rows="13"></textarea>
            </div>
          </div>
          <h2>Forms<span class="pull-right"><a href="https://drive.google.com" target="_blank"><small>Google Drive</small></a></span></h2>
          <ul id="files" class="list-group">
          </ul>
        </div>
      </div>
      <footer style="border-top: 1px solid #EEEEEE;margin: 20px 0 40px;padding-top: 9px;">
        Feeduck is maintained by <a href="https://github.com/jangxyz">Kim, Jang-hwan</a> and <a href="https://github.com/neomparam">neomparam</a>.
      </footer>
    </div>
    <script type="text/javascript" src="assets/feeduck-host.js"></script>
    <script type="text/javascript" src="bootstrap-3.0.1-dist/dist/js/bootstrap.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-45361074-1', 'neomparam.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
